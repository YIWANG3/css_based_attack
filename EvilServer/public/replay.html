<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Replay</title>
    <link rel="stylesheet" href="css/replay.css">
    <script src="js/socket.io.js"></script>
</head>
<body>
<div class="frame-container">
    <iframe id="frame-site" src="/amazon.html"></iframe>
</div>
<div class="log" id="log"></div>
<script>
    const createCoverDom = function (text, boundingRect) {
        let dom = document.createElement("div");
        dom.innerText = text;
        dom.style.width = boundingRect.width + "px";
        dom.style.height = boundingRect.height + "px";
        dom.style.position = "absolute";
        dom.style.left = boundingRect.left + "px";
        dom.style.top = boundingRect.top + "px";
        dom.style.backgroundColor = "rgba(20,87,255,0.75)";
        dom.style.zIndex = "999";
        dom.style.color = "white";
        dom.style.fontWeight = "bold";
        dom.style.fontSize = "18px";
        dom.style.textAlign = "center";
        dom.className = "cover";
        dom.id = Date.now().toString();
        return dom;
    };

    window.onload = () => {
        const iframeWindow = document.getElementById("frame-site").contentWindow;
        const iframeDocument = iframeWindow.document;
        const socket = io();
        socket.on("UPDATE", (data) => {
            document.getElementById("log").innerText += `Type:${data.type}\tDom:${data.payload}\tTime:${data.timestamp}\n`;
            let targetDom = iframeDocument.querySelector(data.payload);
            let bbox = targetDom.getBoundingClientRect();
            let windowScrollY = iframeWindow.scrollY;
            bbox.y += windowScrollY;
            bbox.top += windowScrollY;
            iframeDocument.body.appendChild(createCoverDom(data.type, bbox));
            targetDom.scrollIntoView();
        })
    }
</script>
</body>
</html>
